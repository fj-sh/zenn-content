---
title: "Rails6ã§Tailwind CSSã‚’ä½¿ã£ã¦ã¿ã‚‹"
emoji: "ğŸ•Œ"
type: "tech"
topics: ["rails", "tailwindcss"]
published: true
---

Railsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
```
$ rails new appname -d postgresql
```

Gemfileã«Tailwind CSSã‚’è¿½åŠ ã—ã¾ã™ã€‚

```ruby:Gemfile
gem 'tailwindcss-rails'
```

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
```
$ bin/bundle install
$ bin/rails tailwindcss:install
```

å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚
æ—¢ã«å­˜åœ¨ã—ã¦ã„ã‚‹ã‚‚ã®ã¯ç„¡è¦–ã—ã¾ã™ã€‚

```
$ mkdir app/javascript/css
$ vim app/javascript/css/tailwindcss.css
$ vim app/javascript/packs/application.js
$ vim app/views/layouts/application.html.erb
$ vim postcss.config.js
```


```css:app/javascript/css/tailwindcss.css
@import "tailwindcss/base";
@import "tailwindcss/components";
@import "tailwindcss/utilities";
```

```javascript:app/javascript/packs/application.js
require("@rails/ujs").start()
require("turbolinks").start()
require("@rails/activestorage").start()
require("channels")

import "../css/tailwindcss.css";

// Uncomment to copy all static images under ../images to the output folder and reference
// them with the image_pack_tag helper in views (e.g <%= image_pack_tag 'rails.png' %>)
// or the `imagePath` JavaScript helper below.
//
// const images = require.context('../images', true)
// const imagePath = (name) => images(name, true)

import "stylesheets/application"
```

ä»¥ä¸‹ãŒè¿½è¨˜ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã€‚

```erb:app/views/customer/layouts/application.html.erb
<%= stylesheet_pack_tag "application", "data-turbo-track": "reload" %>
```

```postcss.config.js
module.exports = {
  plugins: [
    require('tailwindcss')("./app/javascript/stylesheets/tailwind.config.js"),
    require('postcss-import'),
    require('postcss-flexbugs-fixes'),
    require('postcss-preset-env')({
      autoprefixer: {
        flexbox: 'no-2009'
      },
      stage: 3
    })
  ]
}
```

ç”»é¢ã¯ä»¥ä¸‹ã€‚

```erb:é©å½“ãªview.html.erb
<div class="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl">
  <div class="md:flex">
    <div class="md:flex-shrink-0">
      <img class="h-48 w-full object-cover md:w-48" src="https://placehold.jp/500x500.png" alt="Man looking at item at a store">
    </div>
    <div class="p-8">
      <div class="uppercase tracking-wide text-sm text-indigo-500 font-semibold">Case study</div>
      <a href="#" class="block mt-1 text-lg leading-tight font-medium text-black hover:underline">Finding customers for your new business</a>
      <p class="mt-2 text-gray-500">Getting a new business off the ground is a lot of hard work. Here are five ideas you can use to find your first customers.</p>
    </div>
  </div>
</div>
```

ãƒ–ãƒ©ã‚¦ã‚¶ã«è¡¨ç¤ºã•ã‚Œã‚‹ç”»é¢ã€‚

![](https://storage.googleapis.com/zenn-user-upload/3o9am0xttskg1ygiz8c3z1yl8jtz)

è‰²ã€…ã¨è¿·ã„ã¾ã—ãŸãŒã€ä»¥ä¸‹2ã¤ã®è¨˜äº‹ã‚’å‚è€ƒã«ã™ã‚Œã°ã‚·ãƒ³ãƒ—ãƒ«ãªæ‰‹é †ã§ã†ã¾ãã„ãã¾ã—ãŸã€‚

- [Rails6ã®åˆæœŸè¨­å®šã‚’ã™ã‚‹ã€œPostgreSQL, Tailwind CSSã€œ](https://qiita.com/salvage0707/items/6470e3c5db383cc89622)
- [Railsã«TailwindCSSã‚’å°å…¥ã™ã‚‹](https://takagi.blog/adding-tailwind-css-to-rails/)


ã“ã®å…ˆã¯å¤±æ•—ä¾‹ã§ã™ã€‚
ãŠãã‚‰ãæ¤œç´¢ã—ã¦è‰²ã€…ã¨è©¦ã—ã¦å¤±æ•—ã™ã‚‹äººã‚‚ã„ã‚‹ã‹ã¨æ€ã„ã¾ã™ã®ã§ã€å¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã—ã¦æ®‹ã—ã¦ãŠãã¾ã™ã€‚

## ã†ã¾ãã„ã‹ãªã‹ã£ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆå¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰

è‰²ã€…ã¨æ¤œç´¢ã—ã¦ã€ŒçœŸä¼¼ã—ã¦ã‚‚ã†ã¾ãã„ã‹ã­ãˆã...ã€ã¨æ‚©ã‚€äººã‚‚ã„ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚
ã“ã“ã‹ã‚‰ä¸‹ã¯3æ™‚é–“ç²˜ã£ã¦çµå±€ã†ã¾ãã„ã‹ãªã‹ã£ãŸè©¦è¡ŒéŒ¯èª¤ã®è¨˜éŒ²ã§ã™ã€‚

åŒã˜ã‚ˆã†ãªãƒŸã‚¹ã‚’ã—ãŸäººã¯ã“ã®è¨˜äº‹ã®ä¸Šã®æ–¹ã®æ‰‹é †ã‚’è©¦ã—ã¦ãã ã•ã„ã€‚

--- 

Railsã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ä½œã£ãŸçŠ¶æ…‹ã‹ã‚‰å§‹ã‚ã¾ã™ã€‚

TailwindCSSã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
```
yarn add tailwindcss postcss autoprefixer
```

ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸå ´åˆã¯`n`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦Node.jsã‚’upgradeã—ã¾ã™ã€‚
```
error tailwindcss@2.1.1: The engine "node" is incompatible with this module. Expected version ">=12.13.0". Got "10.24.0"
error Found incompatible module.
```

ä»¥ä¸‹ã¯Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã®ä½œæ¥­ã§ã™ã€‚

```
# yarn add  n --ignore-engines
# node_modules/n/bin/n stable
# apt purge -y nodejs npm
# exec #SHELL -l
# node -v
v14.16.1
```


Tailwind CSSã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚
```
# npx tailwindcss init
```

`app/javascript/stylesheets/application.scss`ã«ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½è¨˜ã—ã¾ã™ã€‚

```javascript:app/javascript/stylesheets/application.scss
@import "tailwindcss/base";
@import "tailwindcss/components";
@import "tailwindcss/utilities";
```

`app/javascript/packs/application.js`ã«ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½è¨˜ã—ã¾ã™ã€‚

```javascript:app/javascript/packs/application.js
require("@rails/ujs").start()
require("turbolinks").start()
require("@rails/activestorage").start()
require("channels")

require("@rails/ujs").start()
require("turbolinks").start()

require("stylesheets/application.scss")
```

`app/views/layouts/application.html.erb`ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¾ã™ã€‚

```erb:app/views/layouts/application.html.erb
<!DOCTYPE html>
<html>
  <head>
    <link href="https://fonts.googleapis.com/css?family=Inter&display=swap" rel="stylesheet">
    <title>Rokuro</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= stylesheet_pack_tag 'application', 'data-turbolinks-track': 'reload' %>
    <%= javascript_pack_tag 'application', 'data-turbolinks-track': 'reload' %>
  </head>

  <body>
    <%= yield %>
  </body>
</html>
```

ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹`postcss.config.js`ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¾ã™ã€‚

```javascript:postcss.config.js
module.exports = {
  plugins: [
    // if you are using non default config filename
    require("tailwindcss")("tailwind.config.js"),
    require('postcss-import'),
    require('postcss-flexbugs-fixes'),
    require('postcss-preset-env')({
      autoprefixer: {
        flexbox: 'no-2009'
      },
      stage: 3
    })
  ]
}
```


å¿…è¦ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```
# npm install
```

ã“ã“ã¾ã§ã§ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¯å®Œäº†ãªã®ã§ã€å®Ÿéš›ã«åæ˜ ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

`config/application.rb`ã«ä»¥ä¸‹ã‚’è¿½è¨˜ã—ã¾ã™ã€‚

```ruby:config/application.rb
config.generators.assets = false
config.generators.helper = false
```

ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã™ã€‚

```
bin/rails g controller home index
```

rootã¸ã®ãƒ‘ã‚¹ã‚’å®šç¾©ã—ã¾ã™ã€‚

```ruby:routes.rb
Rails.application.routes.draw do
  get 'home/index'
  # For details on the DSL available within this file, see https://guides.rubyonrails.org/routing.html
  root 'home#index'
end
```

```erb:app/views/home/index.html.erb
<h1>This is static#index</h1>
<div class="bg-red-500 w-3/4 mx-auto p-4">
  <p class="text-white text-2xl">Test test test</p>
</div>
```

webpackerã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ã¿ã¾ã™ã€‚

```
# bin/webpack-dev-server
```

Railsã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã™ã€‚

```
# bin/rails s -b 0.0.0.0
```

## ã‚¨ãƒ©ãƒ¼å¯¾å¿œ

ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯Webpackerã®å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…è¦ã§ã™ã€‚
```
ERROR in ./app/javascript/stylesheets/application.scss (./node_modules/css-loader/dist/cjs.js??ref--7-1!./node_modules/postcss-loader/src??ref--7-2!./node_modules/sass-loader/dist/cjs.js??ref--7-3!./app/javascript/stylesheets/application.scss)
Module build failed (from ./node_modules/postcss-loader/src/index.js):
Error: PostCSS plugin tailwindcss requires PostCSS 8.
Migration guide for end-users:
https://github.com/postcss/postcss/wiki/PostCSS-8-for-end-users
    at Processor.normalize (/apps/rokuro/node_modules/postcss/lib/processor.js:153:15)
    at new Processor (/apps/rokuro/node_modules/postcss/lib/processor.js:56:25)
    at postcss (/apps/rokuro/node_modules/postcss/lib/postcss.js:55:10)
    at /apps/rokuro/node_modules/postcss-loader/src/index.js:140:12
â„¹ ï½¢wdmï½£: Failed to compile.

```

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§webpackerã‚’å…¥ã‚Œç›´ã—ã¾ã™ã€‚

```
# yarn remove @rails/webpacker
# yarn add rails/webpacker
# yarn upgrade
```

[rails/webpacker](https://github.com/rails/webpacker)

æ¬¡ã«Gemfileã®webpackerã®è¨­å®šã‚’å¤‰æ›´ã—ã¾ã™ã€‚

```ruby:Gemfile
# gem 'webpacker', '~> 4.0'
gem "webpacker", github: "rails/webpacker"
```

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```
# bundle install
# bundle update webpacker
# rails webpacker:install
# ./bin/webpack
```

ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€`package.json`ã‹ã‚‰`browserslist`ã‚’å‰Šé™¤ã™ã‚‹ã‹ã€ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹`.browserslistrc`ã‚’å‰Šé™¤ã—ã¾ã™ã€‚

```
[webpack-cli] Error [BrowserslistError]: /apps/rokuro contains both .browserslistrc and package.json with browsers
```

ã¾ãŸã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯webpackerã‚’å†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¾ã™ã€‚

```
ActionView::Template::Error (Webpacker can't find application.css in /apps/rokuro/public/packs/manifest.json. Possible causes:
1. You want to set webpacker.yml value of compile to true for your environment
   unless you are using the `webpack -w` or the webpack-dev-server.
2. webpack has not yet re-run to reflect updates.
3. You have misconfigured Webpacker's config/webpacker.yml file.
4. Your webpack configuration is not creating a manifest.
```

```
# rm -rf bin/webpack*
# rails webpacker:install
# bin/webpack-dev-server 
```

ãªã©ã¨æ¤œç´¢ã™ã‚‹ã¨è§£æ±ºç­–ãŒå‡ºã¦ãã¾ã™ãŒã€ã©ã‚Œã‚‚ã†ã¾ãã„ãã¾ã›ã‚“ã§ã—ãŸã€‚
ã“ã®ãƒšãƒ¼ã‚¸ã®å…ˆé ­ã«æˆ»ã£ã¦æ‰‹é †ã‚’ã‚„ã‚Šç›´ã—ã¦ã‚„ã£ã¨ã†ã¾ãã„ãã¾ã—ãŸã€‚