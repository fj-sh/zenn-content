---
title: "Rails6ã§ç§˜å¯†æƒ…å ±ã‚’ç®¡ç†ã™ã‚‹"
emoji: "ğŸŒŠ"
type: "tech"
topics: ["rails"]
published: true
---

Rails6ã§ç§˜å¯†æƒ…å ±ã‚’ç®¡ç†ã—ãŸã„ã¨ãã¯ `bin/rails credentials` ã‚’ä½¿ã„ã¾ã™ã€‚

```
# bin/rails credentials:show
# aws:
#   access_key_id: 123
#   secret_access_key: 345
```

è©¦ã—ã«AWSã® `access_key_id`ã‚’`12345`ã€`secret_acccess_key`ã‚’'6789'ã«è¨­å®šã—ã¦ã€Railsã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§å–ã‚Šå‡ºã—ã¦ã¿ã¾ã™ã€‚

`rails credentials:edit`ã§ç§˜å¯†æƒ…å ±ã‚’ç·¨é›†ã§ãã¾ã™ã€‚
```
/app# bin/rails credentials:edit
```

å®Ÿæ…‹ã¯æš—å·åŒ–ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ« `credentials.yml.enc`ã§ã™ã€‚
`config/credentials.yml.enc` ã‚’ `config/master.key`ã§å¾©å·ã—ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã€ç·¨é›†ãŒçµ‚ã‚ã£ãŸã‚‰ã¾ãŸæš—å·åŒ–ã—ã¦ä¿å­˜ã—ã¦ã„ã¾ã™ã€‚

`rails credentials:edit`ã§è¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆå¾©å·åŒ–ã•ã‚ŒãŸï¼‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚

```
aws: 
  access_key_id: 12345 
  secret_access_key: 6789 
```

ä¿å­˜ã—ãŸæƒ…å ±ã¯æš—å·åŒ–ã•ã‚Œã¦ã„ã¦ã€master.keyãŒãªã„ã¨å¾©å·ã§ãã¾ã›ã‚“ã€‚
ãªã®ã§ã€`config/credentials.yml.enc`ã¯Gitãƒªãƒã‚¸ãƒˆãƒªã«ã‚³ãƒŸãƒƒãƒˆã§ãã¾ã™ã€‚

ä¿å­˜ã—ãŸæƒ…å ±ã¯ `Rails.application.credentials.xxx`ã§å–ã‚Šå‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚

```
/app# bin/rails c

[3] pry(main)> Rails.application.credentials.aws[:access_key_id]
=> 12345
[6] pry(main)> Rails.application.credentials.aws[:secret_access_key]
=> 6789
```

statingç’°å¢ƒç”¨ã®è¨­å®šã‚’ç”¨æ„ã—ãŸã„å ´åˆã¯`--environment staging`ã‚’æŒ‡å®šã—ã¾ã™ã€‚
```
/app# bin/rails credentials:edit --environment staging
```
ã“ã“ã§ç·¨é›†ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯`config/credentials/staging.yml.enc`ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚

developmentç”¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚ŠãŸã„å ´åˆã¯`bin/rails credentials:edit --environment development`ã§ã™ã­ã€‚

é–‹ç™ºä¸­ã«ã‚µãƒ¼ãƒã‚’å‹•ã‹ã—ã¦ã¿ã¦ã€credentialsãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ãŸã¯ãšãªã®ã«nilã§è¿”ã£ã¦ãã¦ã—ã¾ã†ï¼ã¨ã„ã†äººã¯ã€ã¡ã‚ƒã‚“ã¨`--environment development`ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ãŸã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã¦ã¿ã¦ãã ã•ã„ã€‚