---
title: "Chromeæ‹¡å¼µã‚’Vite+TypeScript+Reactã§ä½œã‚‹"
emoji: "ğŸ˜¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["chromeæ‹¡å¼µ"]
published: true
---

Vite + TypeScript + React ã§ Chrome æ‹¡å¼µã‚’ä½œã‚‹æ‰‹é †ã§ã™ã€‚

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```console
npm init vite@latest
âœ” Project name: â€¦ .
âœ” Current directory is not empty. Remove existing files and continue? â€¦ yes
âœ” Select a framework: â€º react
âœ” Select a variant: â€º react-ts

Scaffolding project in /Users/fj/dev/searchable-bookmarks...

Done. Now run:

  npm install
  npm run dev
```

```console
npm i @crxjs/vite-plugin -D --force

# Fix the upstream dependency conflict, or retry ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆã¯ã€å•é¡ŒãŒãªã„ã‹ç¢ºèªã—ãŸä¸Šã§ --force ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
# npm i @crxjs/vite-plugin -D --force
```

`vite.config.ts` ã‚’ç·¨é›†ã—ã¾ã™ã€‚

```ts:vite.config.ts
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import { crx, defineManifest } from '@crxjs/vite-plugin'

const manifest = defineManifest({
  manifest_version: 3,
  name: 'æ‹¡å¼µæ©Ÿèƒ½ã®åå‰',
  description:
    'æ‹¡å¼µæ©Ÿèƒ½ã®èª¬æ˜',
  version: '1.0.0',
  icons: {
    '16': 'icon.png',
    '48': 'icon.png',
    '128': 'icon.png',
  },
  action: {
    default_popup: 'index.html',
  },
})

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react(), crx({ manifest })],
})
```

`icons` ã®ã‚¢ã‚¤ã‚³ãƒ³ã®ç”»åƒã¯`public`ç›´ä¸‹ã«ç½®ãã¾ã™ã€‚

permission ã®è¿½åŠ ãŒå¿…è¦ãªå ´åˆã¯ã€`vite.config.ts` ã®ä»¥ä¸‹ã®éƒ¨åˆ†ã«è¿½åŠ ã—ã¾ã™ã€‚

[Declare permissions](https://developer.chrome.com/docs/extensions/mv3/declare_permissions/)

```ts:vite.config.ts
const manifest = defineManifest({
  manifest_version: 3,
  name: 'æ‹¡å¼µæ©Ÿèƒ½ã®åå‰',
  description:
    'æ‹¡å¼µæ©Ÿèƒ½ã®èª¬æ˜',
  version: '1.0.0',
  icons: {
    '16': 'icon.png',
    '48': 'icon.png',
    '128': 'icon.png',
  },
  action: {
    default_popup: 'index.html',
  },
  permissions: [
    "tabs",
    "bookmarks",
    "unlimitedStorage"
  ],
})

```

`content_scripts` ã‚„ `background` ã®è¿½åŠ ãŒå¿…è¦ãªå ´åˆã‚‚ã€`vite.config.ts` ã«è¿½è¨˜ã—ã¾ã™ã€‚
ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®æŒ‡å®šã¯ã€`src/`ã‹ã‚‰å§‹ã‚ã¾ã™ã€‚suffix ã¯ `.ts`ã®ã¾ã¾æŒ‡å®šã—ã¦ OK ã§ã™ã€‚

```ts:vite.config.ts
const manifest = defineManifest({
  // çœç•¥
  action: {
    default_popup: 'index.html',
  },
  permissions: ['storage', 'alarms', 'tabs'],
  background: {
    service_worker: 'src/background-script/background.ts',
    type: 'module',
  },
  content_scripts: [
    {
      matches: ['https://tinder.com/*'],
      js: ['src/content-script/index.ts'],
    },
  ],
})

```

- [Content scripts](https://developer.chrome.com/docs/extensions/mv3/content_scripts/)
- [Migrating from background pages to service workers](https://developer.chrome.com/docs/extensions/mv3/migrating_to_service_workers/)

## ãƒ–ãƒ©ã‚¦ã‚¶ã§ Chrome æ‹¡å¼µã‚’å‹•ã‹ã—ã¦ã¿ã‚‹

é–‹ç™ºä¸­ã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ Vite ã‚’èµ·å‹•ã—ã¾ã™ã€‚

```console
npm run dev
```

ã‚¿ãƒ–ãƒãƒ¼ã®æ¨ªã«ã‚ã‚‹ Chrome æ‹¡å¼µã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ã€ŒChrome æ‹¡å¼µã‚’ç®¡ç†ã€ã‚’é–‹ãã¾ã™ã€‚

å³ä¸Šã«ã€Œãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã€ã¨ã„ã†ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ãŒã‚ã‚‹ã®ã§ã€ã“ã¡ã‚‰ã‚’ã€ŒONã€ã«ã—ã¾ã™ã€‚

ã€Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã•ã‚Œã¦ã„ãªã„æ‹¡å¼µæ©Ÿèƒ½ã‚’èª­ã¿è¾¼ã‚€ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

é–‹ç™ºä¸­ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯`dist`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒã§ãã¾ã™ã®ã§ã€ãã®`dist`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’é¸æŠã—ã¾ã™ã€‚

ã™ã‚‹ã¨æ‹¡å¼µæ©Ÿèƒ½ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚

ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹ã¨ãã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```console
npm run build
```

åŒã˜ã‚ˆã†ã«`dist`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’èª­ã¿è¾¼ã‚ã° OK ã§ã™ã€‚

Chrome ã‚¦ã‚§ãƒ–ã‚¹ãƒˆã‚¢ã«å…¬é–‹ã™ã‚‹ãŸã‚ã«ã¯ã€[ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰](https://chrome.google.com/webstore/developer/dashboard)ã‹ã‚‰ã€ãƒ“ãƒ«ãƒ‰ã—ãŸæ‹¡å¼µæ©Ÿèƒ½ã‚’ zip ã§åœ§ç¸®ã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚
