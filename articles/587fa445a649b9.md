---
title: "Node.js ã§ Jira ã® API ã‹ã‚‰èª²é¡Œæƒ…å ±ã‚’å–å¾—ã™ã‚‹"
emoji: "ğŸ¡"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["jira"]
published: true
---

## ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³

- Jira ã®èª²é¡Œã«ã¯ StoryPoint ã‚’è¨­å®šã—ã¦ã„ãŸãŒã€Jira ã®ç”»é¢ä¸Šã ã‘ã§ã¯å¿…è¦ãªæƒ…å ±ã‚’å¿…è¦ãªå½¢ã§å–ã£ã¦ã“ã‚Œãªã‹ã£ãŸ
- ä»Šå›ã®ã‚¹ãƒ—ãƒªãƒ³ãƒˆã‚„å‰å›ã®ã‚¹ãƒ—ãƒªãƒ³ãƒˆã§ã©ã‚Œã ã‘ã® StoryPoint ã‚’æ¶ˆåŒ–ã§ããŸã‹ã‚’çŸ¥ã‚ŠãŸã‹ã£ãŸï¼ˆã“ã‚Œã¯ Jira ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ©Ÿèƒ½ã«ã‚‚ã‚ã‚‹ãŒã€è‰²ã€…ã¨çµã‚Šè¾¼ã¿æ¡ä»¶ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ãŸã‹ã£ãŸï¼‰
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å…¨ä½“ã® StoryPoint ã‚’æ¶ˆåŒ–ã™ã‚‹ãŸã‚ã«ã¯ã€ã‚ã¨ä½•ã‚¹ãƒ—ãƒªãƒ³ãƒˆå¿…è¦ãªã®ã‹ã‚’çŸ¥ã‚ŠãŸã‹ã£ãŸï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®äºˆæ¸¬ã‚’æ•°å€¤ã«ã—ã¦å ±å‘Šã™ã‚‹ãŸã‚ï¼‰
- [Jira ã®èª²é¡Œã‚’ Excel ã«å‡ºåŠ›ã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³](https://marketplace.atlassian.com/apps/1221301/jira-cloud-for-excel-official?tab=overview&hosting=cloud)ã¯ã‚ã‚‹ãŒã€ãƒ‡ãƒ¼ã‚¿ãŒè¤‡é›‘ãªã®ã§ã€ Excel ã§é ‘å¼µã‚‹ã‚ˆã‚Šã‚‚ã€API ã§å–å¾—ã—ã¦ TypeScript ã§ã„ã˜ã£ãŸæ–¹ãŒç°¡å˜ãã†ã ã£ãŸ

ä¸Šè¨˜ã®ç†ç”±ã‹ã‚‰ã€Jira ã® API ã‹ã‚‰èª²é¡Œã‚’å–å¾—ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚

## API ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½œæˆ

ã¾ãšã¯ API ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½œæˆã—ã¾ã™ã€‚

JIRA ç”»é¢ã®å³ä¸Šãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ã‚¯ãƒªãƒƒã‚¯
ã€€ â†“
è¨­å®š ã‚’ã‚¯ãƒªãƒƒã‚¯
ã€€ â†“
ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®è¨­å®šï¼ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç’°å¢ƒè¨­å®šï¼‰ã‚’ã‚¯ãƒªãƒƒã‚¯
ã€€ â†“
å·¦å´ã®ã€Œã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã€ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
ã€€ â†“
API ãƒˆãƒ¼ã‚¯ãƒ³ã®ä½œæˆã¨ç®¡ç† ã‚’ã‚¯ãƒªãƒƒã‚¯
ã€€ â†“
API ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½œæˆã™ã‚‹ã€€ã‚’ã‚¯ãƒªãƒƒã‚¯

ã“ã“ã§ API ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½œæˆã—ã€ã‚³ãƒ”ãƒ¼ã—ã¦ãŠãã¾ã™ã€‚

## jira-client ã§ã‚¢ã‚¯ã‚»ã‚¹

Jira ã® API ã¯ [jira-client](https://www.npmjs.com/package/jira-client) ã‚’ä½¿ã£ã¦å©ãã¾ã™ã€‚

```console
npm i dotenv
npm i jira-client
npm i -D @types/jira-client
```

`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã‚’ç”¨æ„ã—ã¾ã™ã€‚

```.env
JIRA_HOST="[ä¼šç¤¾ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ].atlassian.net"
MAIL_ADDRESS="ãƒ¦ãƒ¼ã‚¶ãƒ¼åã«ä½¿ã£ã¦ã„ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"
JIRA_API_TOKEN="è¨­å®šç”»é¢ã‹ã‚‰å–å¾—ã—ãŸAPIãƒˆãƒ¼ã‚¯ãƒ³"
PROJECT_NAME="Jiraã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã€‚ èª²é¡Œã®JQLã§project = 'XXX'ã§æŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‚„ã¤"
```

API ã‹ã‚‰ Jira ã®èª²é¡Œã‚’å–å¾—ã™ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```js
import JiraApi, { JsonResponse } from "jira-client";
import dotenv from "dotenv";

dotenv.config();

const host = process.env.JIRA_HOST ?? undefined;
const mailAddress = process.env.MAIL_ADDRESS ?? undefined;
const apiToken = process.env.JIRA_API_TOKEN ?? undefined;
const projectName = process.env.PROJECT_NAME ?? undefined;

let jiraClient: JiraApi | undefined;
function getJiraClient() {
  if (
    host === undefined ||
    mailAddress === undefined ||
    apiToken === undefined
  ) {
    throw new Error("ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚");
  }
  if (jiraClient === undefined) {
    jiraClient = new JiraApi({
      protocol: "https",
      host,
      username: mailAddress,
      password: apiToken,
      apiVersion: "2",
      strictSSL: true,
    });
  } else {
    console.log("jiraClient ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã¦ã„ã¾ã™ã€‚");
  }
  return jiraClient;
}

export async function getAllIssues() {
  const client = getJiraClient();
  if (client === undefined) {
    throw new Error("jiraClient ãŒç”Ÿæˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚");
  }

  if (projectName === undefined) {
    throw new Error("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåãŒç’°å¢ƒå¤‰æ•°ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚");
  }
  const jql = `project = "${projectName}" ORDER BY created DESC`;

  const jiraResponse: JsonResponse = await client.searchJira(jql, {
    startAt: 0,
    maxResults: 10,
  });

  const jira: Jira = {
    startAt: jiraResponse.startAt,
    maxResults: jiraResponse.maxResults,
    total: jiraResponse.total,
    issues: jiraResponse.issues,
  };

  console.log(jira.total);
}
```

ä»¥ä¸‹ã®éƒ¨åˆ†ã§ `maxResults` ã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚
æœ€å¤§ãŒ `100` ã§ã™ã€‚

```js
await client.searchJira(jql, {
  startAt: 1,
  maxResults: 10,
});
```

ãã®ãŸã‚ã€100 ä»¥ä¸Šã®èª²é¡Œã‚’ã™ã¹ã¦å–å¾—ã™ã‚‹å ´åˆã¯ã€ `(total / maxResults) + 1` å›åˆ† ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŠ•ã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

## Jira ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã†ã¡ã€å¿…è¦ãªã‚‚ã®ã®å‹ã‚’ã¤ã‘ã¦ã„ã

Jira ã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ any å‹ã§å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚

å‹å®šç¾©ã¯ä»¥ä¸‹ã§ã™ã€‚

```js
interface JsonResponse {
  [name: string]: any;
}
```

å®Ÿéš›ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¦‹ã¦ã‚‚ã€ä»¥ä¸‹ã®ã‚ˆã†ãªä¸å®šå½¢ã¨æ€ã‚ã‚Œã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå¤šã€…ã‚ã‚Šã¾ã™ã€‚

```json
customfield_10128: null,
customfield_10007: null,
customfield_10129: null,
```

ã“ã‚Œã‚‰ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã¯ã€ã€Œè‡ªåˆ†ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€ã ã‘ã§ãªãã€ã€Œç¤¾å†…ã®ä»–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§è¨­å®šã—ãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ã‚‚å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

ã¤ã¾ã‚Šã€ç¤¾å†…ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–“ã§ Jira ã®ä½¿ã„æ–¹ãŒçµ±ä¸€ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€è‡ªåˆ†ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¨ã£ã¦ã¯ä¸è¦ãªï¼ˆä»–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½œæˆã—ãŸï¼‰ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå¤§é‡ã«ç´›ã‚Œè¾¼ã‚“ã§ãã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚

è‡ªåˆ†ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½¿ã£ã¦ã„ãªã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ã¯ `null` ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚

ãã®ä»–ã«ã‚‚ `issues` ã®ä¸­ã« `fields` ãŒã‚ã£ã¦ã€ ãã® `fields` ãŒæŒã£ã¦ã„ã‚‹ `parent` ãŒ `issue` ã¨åŒã˜å‹ã«ãªã£ã¦ã„ã¦ä½¿ã„ã¥ã‚‰ã‹ã£ãŸã‚Šã€è‰²ã€…ã¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå…¥ã‚Œå­ã«ãªã£ã¦ã„ãŸã‚Šã¨ã€ãã®ã¾ã¾ã ã¨éå¸¸ã«ä½¿ã„ã«ãã„ã‚ˆã†ã«æ„Ÿã˜ã¾ã—ãŸã€‚

ãã‚“ãªã‚ã‘ã§ã€å‹ã‚’è‡ªåˆ†ã§å®šç¾©ã—ã¦ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å‹ã«ã¯ã‚ã¦ã„ã‘ã°ã€API ã‹ã‚‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã®åˆ©ç”¨ãŒæ¥½ã«ãªã‚Šã¾ã™ã€‚

æ¥­å‹™çš„ãªã®æƒ…å ±ãŒå…¥ã‚‰ãªã„ã‚ˆã†ã«ã‚³ãƒ¼ãƒ‰ã‚’æŠœç²‹ã™ã‚‹ã¨ã€ã“ã‚“ãªæ„Ÿã˜ã«å‹ã‚’ä½œã‚Šã¾ã™ã€‚

```js:lib/types/index.ts

export type Jira = {
  startAt: number
  maxResults: number
  total: number
  issues: Issue[]
}

export type Issue = {
  id: string
  key: string
  fields: Fields
}

export type Fields = {
  parent: Parent
  summary: string
  status: Status
  targetServices: TargetService[] // ã“ã“ã¯ä¼šç¤¾ç‰¹æœ‰ã®ã‚‚ã®ã€‚fields.customfield_xxxx ã®å€¤ã‚’å…¥ã‚Œã‚‹
  sprints: Sprint[]
  storyPoint: number  // fields.customfield_yyyy ã®å€¤ã‚’å…¥ã‚Œã‚‹
  created: string
  updated: string
  description: string
  statuscategorychangedate: string
}
```

ä¸Šã®å‹ã‚’ã¤ã‘ã‚‹ä½œæ¥­ã¯ã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰ãŒä¸å®šã§ã‚ã‚‹ãŒã‚†ãˆã«ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å€¤ã‚’è¦‹ãªãŒã‚‰å„è‡ªãŒé ‘å¼µã£ã¦è¨­å®šã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

é ‘å¼µã£ã¦å‹ã‚’ã¤ã‘ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚

```js:lib/issues.ts
// ã‚µãƒ³ãƒ—ãƒ«ã§ã™
function otharfunc() {
  const jira: Jira = {
    startAt: jiraResponse.startAt,
    maxResults: jiraResponse.maxResults,
    total: jiraResponse.total,
    issues: jiraResponse.issues,
  }

  // å‹ã‚’ã¤ã‘ã‚‹é–¢æ•°ã‚’å‘¼ã‚“ã§ã‚‹
  const typedJira = getTypedJira(jira)
}



function getTypedJira(jira: any): Jira {
  const typedIssues: Issue[] = jira.issues.map((issue: Issue) => {
    const fields: any = issue.fields
    const sprints = fields.customfield_xxxx.map((sprint: any) => {
      return {
        name: sprint.name,
        state: sprint.state,
        startDate: sprint.startDate,
        endDate: sprint.endDate,
      }
    })
    const typedFields: Fields = {
      parent: {
        summary: fields.parent.fields.summary,
      },
      summary: fields.summary,
      status: fields.status,
      targetServices: fields.customfield_xxxx,
      sprints,
      storyPoint: fields.customfield_yyy,
      created: fields.created,
      updated: fields.updated,
      description: fields.description,
      statuscategorychangedate: fields.statuscategorychangedate,
    }
    return {
      id: issue.id,
      key: issue.key,
      fields: typedFields,
    }
  })
  const typedJira: Jira = {
    startAt: jira.startAt,
    maxResults: jira.maxResults,
    total: jira.total,
    issues: typedIssues,
  }
  return typedJira
}

```

ä¸Šã®ä¾‹ã§å‹ã‚’ã¤ã‘ãŸ `typedJira` ã¯å…ƒã€…ã® Jira ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒåæ˜ ã•ã‚ŒãŸå½¢ã«ãªã£ã¦ã„ã‚‹ã®ã§ã€ãƒã‚¹ãƒˆãŒå¤šãã¦è‹¥å¹²ä½¿ã„ã¥ã‚‰ã„ã§ã™ã€‚

ãã®ãŸã‚ã€è‡ªåˆ†ã¯ `typedJira` ã® `issues[n].fields` ã‹ã‚‰æœ¬å½“ã«ã»ã—ã„æƒ…å ±ã‚’å–ã£ã¦ãã¦ã€åˆ¥ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å…¥ã‚Œã¦ä½¿ã£ã¦ã„ã¾ã™ï¼ˆæ–‡ç« ã ã¨ä¼ã‚ã‚Šã«ãã„ã§ã™ã­ï¼‰

ã‚³ãƒ¼ãƒ‰ä¾‹ã‚’è¨˜äº‹ã«ã—ãŸã„ã¨ã“ã‚ã§ã™ãŒã€ã“ã“ã¾ã§ã„ãã¨ä»•äº‹ã«å¯„ã‚Šã™ãã¦ã—ã¾ã†ã®ã§ã€æ³£ãæ³£ãå‰²æ„›ã—ã¾ã™ã€‚

å„è‡ªã„ã„æ„Ÿã˜ã«å‹ã‚’ã¤ã‘ã¦ Jira ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ä½¿ã†ã®ãŒè‰¯ã„ã¨æ€ã„ã¾ã™ã€‚

ã‚ã¨ã¯å€‹äººçš„ãªå·¥å¤«ç‚¹ã¨ã—ã¦ã€å‹ã‚’ã¤ã‘ãŸ Jira ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦ãŠãã€JSON ãƒ•ã‚¡ã‚¤ãƒ«ã«æ—¥ä»˜ã‚’ã¤ã‘ã¦ä¿å­˜ã—ã¦ãŠãã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

ä½•åº¦ã‚‚ Jira ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŠ•ã’ã¦ã‚‚ãã‚“ãªã«é »ç¹ã«ã¯çµæœã¯å¤‰ã‚ã‚‰ãªã„ã‹ã‚‰ã§ã™ã€‚

åŒã˜æ—¥ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒãªã„ã¨ãã¯ãƒ­ãƒ¼ã‚«ãƒ«ã® JSON ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§è¿”ã™ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚
