---
title: "Azure Event Hub ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å¥‘æ©Ÿã«ã—ã¦ Azure Functions ã®é–¢æ•°ã‚’èµ·å‹•ã™ã‚‹ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã§é–¢æ•°ã‚’å‹•ã‹ã™ï¼‰"
emoji: "ğŸ™"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: []
published: true
---

Event ãƒˆãƒªã‚¬ãƒ¼ã«ã—ã¦ Azure Functions ã®é–¢æ•°ã‚’å‹•ã‹ã™æ‰‹é †ã§ã™ã€‚

ã€Œæ¥ç¶šæ–‡å­—åˆ— - ä¸»ã‚­ãƒ¼ã€ã®è¨­å®šãªã©ãŒã‚ã‹ã‚Šã¥ã‚‰ã‹ã£ãŸã®ã§ã€æ‰‹é †ã‚’ã¾ã¨ã‚ã¾ã™ã€‚

## Event Hubs ã‚’ä½œæˆã™ã‚‹

ãƒªã‚½ãƒ¼ã‚¹ã®ä½œæˆ â†’ Event Hubs â†’ ä½œæˆ

ã§ã€Event Hubs ã®ã€Œåå‰ç©ºé–“ã®ä½œæˆã€ã‚’è¡Œã„ã¾ã™ã€‚

ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã¨ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã¯ä»»æ„ã®ã‚‚ã®ã‚’é¸ã³ã¾ã™ã€‚

- åå‰ç©ºé–“ã®åå‰ã€Œsample-azfunc-basic-eventhubã€ã¨ã—ã¾ã™
- å ´æ‰€ã€Œæ±ã‚¢ã‚¸ã‚¢ã€
- ä¾¡æ ¼ãƒ¬ãƒ™ãƒ«ã€ŒBasicã€

ã§ä½œæˆã—ã¾ã™ã€‚

sample-azfunc-basic-eventhub ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Œäº†ã—ã¾ã—ãŸã€ã¨ã„ã†è¡¨ç¤ºãŒå‡ºãŸã‚‰ã€ã€Œãƒªã‚½ãƒ¼ã‚¹ã«ç§»å‹•ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

ãƒªã‚½ãƒ¼ã‚¹ã«ç§»å‹•ã—ãŸã‚‰ã€çœŸã‚“ä¸­ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã€Œï¼‹ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ–ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ–ã‚’ä½œæˆã—ã¾ã™ã€‚

- åå‰ã€Œsamples-workitemsã€

ã¨ã—ã¾ã™ã€‚

ä½œæˆå¾Œã€ç”»é¢ã‚’è¦‹ã‚‹ã¨ã€ã€Œsample-azfunc-basic-eventhubã€ã¨ã„ã†ã€ŒEvent Hubs åå‰ç©ºé–“ã€ã§ã™ãŒã€ä¸‹ã®æ–¹ã«ã€Œåå‰ `samples-workitems`ã€ãŒã§ãã¦ã„ã¾ã™ã€‚

ã€ŒEvent Hubs åå‰ç©ºé–“ã€ã®å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã€Œå…±æœ‰ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã€ãŒã‚ã‚Šã¾ã™ã€‚

ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ŒRootManageSharedAccessKeyã€ãƒãƒªã‚·ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

ã€ŒRootManageSharedAccessKeyã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ä¸»ã‚­ãƒ¼ã¨ã„ã†ã‚‚ã®ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã“ã®ä¸»ã‚­ãƒ¼ã‚’ä½¿ã£ã¦ã€Event Hubs åå‰ç©ºé–“ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

ãŸã ã—ã€æœ¬æ¥ã§ã‚ã‚Œã°ç®¡ç†ç”¨ã®ã‚­ãƒ¼ã‚’ä½¿ã†ã¹ãã§ã¯ãªãã€åˆ¥ã®ã‚­ãƒ¼ã‚’ä½œæˆã™ã‚‹ã®ãŒè‰¯ã„ã§ã—ã‚‡ã†ã€‚

[JavaScript (azure/event-hubs) ã‚’ä½¿ç”¨ã—ã¦ Event Hubs ã¨ã®é–“ã§ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€å—ä¿¡ã™ã‚‹](https://docs.microsoft.com/ja-jp/azure/event-hubs/event-hubs-node-get-started-send) ã‚’å‚è€ƒã«ã€ Event Hubs ã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚

```console
npm install @azure/event-hubs
```

JavaScript ã®ã‚³ãƒ¼ãƒ‰ã¯å…¬å¼ã‚¬ã‚¤ãƒ‰ã«ã¡ã‚‡ã£ã¨è£œè¶³ã—ã¾ã™ã€‚

```js:src/send.js
const { EventHubProducerClient } = require("@azure/event-hubs");

const connectionString =
  "Endpoint=sb://[Event Hubs ã®åå‰ç©ºé–“].servicebus.windows.net/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=[ã“ã“ã«å…±æœ‰ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã§å–å¾—ã—ãŸä¸»ã‚­ãƒ¼ãŒå…¥ã‚‹]";
const eventHubName = "Event Hubs åå‰ç©ºé–“ã«å±ã™ã‚‹ Event Hub ã®åå‰ã‚’è¨­å®šã™ã‚‹";

async function main() {
  const producer = new EventHubProducerClient(connectionString, eventHubName);

  const batch = await producer.createBatch();
  batch.tryAdd({ body: "1ã¤ã‚ã®ã‚¤ãƒ™ãƒ³ãƒˆ" });
  batch.tryAdd({ body: "2ã¤ã‚ã®ã‚¤ãƒ™ãƒ³ãƒˆ" });
  batch.tryAdd({ body: "3ã¤ã‚ã®ã‚¤ãƒ™ãƒ³ãƒˆ" });

  await producer.sendBatch(batch);

  await producer.close();

  console.log("Event Hubs ã«3ã¤ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚");
}

main().catch((err) => {
  console.log("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸï¼š", err);
});
```

Azure ã®å…¬å¼ã‚¬ã‚¤ãƒ‰ã§ã¯ `connectionString` ã¨ `eventHubName` ã«ä½•ãŒå…¥ã‚‹ã®ã‹ã‚ã‹ã‚Šã¥ã‚‰ã‹ã£ãŸã®ã§ã™ãŒã€

```js
const connectionString = "EVENT HUBS NAMESPACE CONNECTION STRING";
const eventHubName = "EVENT HUB NAME";
```

ã¾ãš `connectionString` ã«ã¯ã€Œæ¥ç¶šæ–‡å­—åˆ— - ä¸»ã‚­ãƒ¼ã€ãŒå…¥ã‚Šã¾ã™ã€‚

Event Hubs åå‰ç©ºé–“ ã®å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€Œå…±æœ‰ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰ã€RootManagesSharedAccessKey ãªã‚‹ã‚­ãƒ¼ãŒå‡ºã¦ãã‚‹ã¨æ€ã„ã¾ã™ã®ã§ã€ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€å³å´ã« SAS ãƒãƒªã‚·ãƒ¼ ãªã‚‹ã‚‚ã®ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

ã“ã“ã«ã€Œæ¥ç¶šæ–‡å­—åˆ— - ä¸»ã‚­ãƒ¼ã€ãŒã‚ã‚Šã¾ã™ï¼ˆæœ¬ç•ªé‹ç”¨ã§ã¯æ–°ãŸã«ã‚­ãƒ¼ã‚’ä½œã£ã¦ãŠãã®ãŒæ™®é€šãªã‚ˆã†ã§ã™ï¼‰

`eventHubName`ã«ã¯ã€ŒEvent Hubs åå‰ç©ºé–“ã€ã®å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã€Œã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ - Event Hubsã€ ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¡¨ç¤ºã•ã‚Œã‚‹ã€Œåå‰ã€ã‚’å…¥ã‚Œã¾ã™ã€‚

å­˜åœ¨ã—ãªã„å ´åˆã¯ã€Œã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ - Event Hubsã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€Œï¼‹ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ–ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€æ–°ãŸã« Event Hub ã‚’ä½œã‚Šã¾ã™ã€‚

ã“ã®è¨˜äº‹ã®æµã‚Œã ã¨ `const eventHubName = "samples-workitems"` ã¨ãªã‚Šã¾ã™ã­ã€‚

`node` ã‚³ãƒãƒ³ãƒ‰ã§ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡ã§ãã¾ã™ã€‚

## é–¢æ•°ã‚’ä½œæˆã™ã‚‹

ã€Œãƒªã‚½ãƒ¼ã‚¹ã®ä½œæˆã€â†’ã€Œé–¢æ•°ã‚¢ãƒ—ãƒªã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

ã€Œé–¢æ•°ã‚¢ãƒ—ãƒªã€â†’ã€Œï¼‹ä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ã€Œé–¢æ•°ã‚¢ãƒ—ãƒªã®ä½œæˆã€ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

- é–¢æ•°ã‚¢ãƒ—ãƒªåï¼ševenthub-app
- ãƒ©ãƒ³ã‚¿ã‚¤ãƒ  ã‚¹ã‚¿ãƒƒã‚¯ï¼š Node.js
- ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼š14 LTS
- åœ°åŸŸï¼šJapan East

ã§ã€ã€Œç¢ºèªãŠã‚ˆã³ä½œæˆã€

æ¬¡ã®ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã§é©å½“ãªã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã€ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã¯ Linuxã€ãƒ—ãƒ©ãƒ³ã¯ã‚µãƒ¼ãƒãƒ¬ã‚¹ã«ã—ã¾ã™ã€‚

ç¢ºèªãŠã‚ˆã³ä½œæˆã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€é–¢æ•°ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¾ã™ã€‚

é–¢æ•°ã‚¢ãƒ—ãƒªã‚’é–‹ãã¨ã€å·¦å´ã«ã€Œé–¢æ•°ã€ã¨ã„ã†ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

ã™ã‚‹ã¨ã€å³å´ã«ã€Œé–¢æ•°ã®ä½œæˆã€ã¨ã„ã†ãƒšãƒ¼ã‚¸ãŒå‡ºã¦ãã¾ã™ã€‚

ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§é–¢æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã£ã¦ã¿ãªã•ã„ã€ã¨è¨€ã£ã¦ã¾ã™ã€‚

```console
# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install -g azure-functions-core-tools@4 --unsafe-perm true

# Azure Functions ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹
func init

# é–¢æ•°ã‚’ä½œæˆã™ã‚‹
func new

# é–¢æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œã™ã‚‹
func start
```

`func init` ã§ãƒ­ãƒ¼ã‚«ãƒ«ã« Azure Functions ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã€ãã®ä¸­ã« `func new` ã§é–¢æ•°ã‚’ä½œã£ã¦ã„ãã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚

Azure Functions ã¨ Event Hub ã‚’é€£æºã•ã›ã‚‹ã«ã‚ãŸã‚Šã€è¿·ã†ã®ã¯

ã€Œé–¢æ•°ã® `local.settings.json` ã¨ `function.json` ã«ä½•ã‚’ã©ã†æ›¸ãã‹ã€

ã ã¨æ€ã„ã¾ã™ã€‚

ä»¥ä¸‹ã® StackOverFlow ãŒå‚è€ƒã«ãªã‚Šã¾ã—ãŸã€‚

[Azure Function app : Microsoft.Azure.WebJobs.EventHubs: Value cannot be null. (Parameter 'receiverConnectionString')](https://stackoverflow.com/questions/60640205/azure-function-app-microsoft-azure-webjobs-eventhubs-value-cannot-be-null-p)

`func new` ã—ã¦ä½œæˆã—ãŸã€ŒEvent Hub ãƒˆãƒªã‚¬ãƒ¼ã®é–¢æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€ã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯`local.settings.json`ãªã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚

> local.settings.json:é–¢æ•°ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œã™ã‚‹ã¨ãã«ä½¿ç”¨ã•ã‚Œã‚‹è¨­å®šã‚’ä¿æŒã—ã¾ã™ã€‚ Azure ã§å®Ÿè¡Œã—ã¦ã„ã‚‹å ´åˆã€ã“ã‚Œã‚‰ã®è¨­å®šã¯ä½¿ç”¨ã•ã‚Œã¾ã›ã‚“
> local.settings.json ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å«ã‚ã‚‹ã“ã¨ãŒã§ãã‚‹ãŸã‚ã€ãã‚Œã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ ã‚½ãƒ¼ã‚¹ç®¡ç†ã‹ã‚‰é™¤å¤–ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
> [Visual Studio ã‚’ä½¿ç”¨ã™ã‚‹ Azure Functions ã®é–‹ç™º](https://docs.microsoft.com/ja-jp/azure/azure-functions/functions-develop-vs?tabs=in-process)

ã“ã® `local.settings.json` ã« EventHub ã®æ¥ç¶šæ–‡å­—åˆ—ã‚’è¨­å®šã—ã¾ã™ã€‚

```json:local.settings.json
{
  "IsEncrypted": false,
  "Values": {
    "FUNCTIONS_WORKER_RUNTIME": "node",
    "AzureEventHubConnectionString": "Endpoint=sb://[Event Hub ã®åå‰ç©ºé–“].servicebus.windows.net/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=[ä¸»ã‚­ãƒ¼]",
    "AzureWebJobsStorage": "DefaultEndpointsProtocol=https;AccountName=[ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å];AccountKey=[ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼];EndpointSuffix=core.windows.net"
  }
}
```

ã“ã“ã® `AzureEventHubConnectionString` ã«ã¯ã€ŒEvent Hub åå‰ç©ºé–“ã€ã®ã€Œå…±æœ‰ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã€ã§å–å¾—ã§ãã‚‹ã€ã€Œæ¥ç¶šæ–‡å­—åˆ— - ä¸»ã‚­ãƒ¼ã€ã‚’è¨­å®šã—ã¾ã™ã€‚

`AzureWebJobsStorage` ã«ã¯ã€ã€Œã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€ã«å¯¾ã™ã‚‹ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã‚’è¨­å®šã—ã¾ã™ã€‚

æœ€åˆã®ã‚µãƒ¼ãƒ“ã‚¹é¸æŠç”»é¢ã‹ã‚‰ã€Œã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€é–¢æ•°ä½œæˆã®ã¨ãã«ä½œã£ãŸã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸åã‚’é¸ã³ã¾ã™ã€‚

å·¦å´ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã® ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ - ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

ã™ã‚‹ã¨ã€Œã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã€ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã®ã§ã€ã€Œã‚­ãƒ¼ã®è¡¨ç¤ºã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ã€Œæ¥ç¶šæ–‡å­—åˆ—ã€ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚

æ¬¡ã«ã€`func new` ã§ä½œæˆã—ãŸé–¢æ•°ã®ä¸­ã« `function.json` ãŒã‚ã‚‹ã®ã§ã€é–‹ãã¾ã™ã€‚

```json:function.json
{
  "bindings": [
    {
      "type": "eventHubTrigger",
      "name": "é–¢æ•°ã®åå‰",
      "direction": "in",
      "eventHubName": "Event Hubs ã®åå‰",
      "connection": "AzureEventHubConnectionString",
      "cardinality": "many",
      "consumerGroup": "$Default"
    }
  ]
}

```

`type` ã¯ `eventHubTrigger` ã§ã€`name` ã¯è‡ªå‹•ã§ä½œã‚‰ã‚Œã¾ã™ã€‚

`eventHubName` ã§ã™ãŒã€ã“ã‚Œã¯ Event Hubs ã®åå‰ç©ºé–“ã§ã¯ãªãã€ Event Hubs ã®åå‰ç©ºé–“ã®å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã® ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ - Event Hubs ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä½œæˆã—ãŸ Event Hub ã®åå‰ã‚’æŒ‡å®šã—ã¾ã™ã€‚

`connection` ã«ã¯ã€ `local.settings.json` ã§è¨­å®šã—ãŸã‚­ãƒ¼ã®åå‰ `AzureEventHubConnectionString` ã‚’æŒ‡å®šã—ã¾ã™ã€‚

é–¢æ•°ã® JavaScript ã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚

```js:EventHubTrigger/index.js
module.exports = async function (context, eventHubMessages) {
    context.log(`JavaScript eventhub trigger function called for message array ${eventHubMessages}`);
    context.log('Function triggered to process a message: ', eventHubMessages);
    context.log('EnqueuedTimeUtc =', context.bindingData.enqueuedTimeUtc);
    context.log('SequenceNumber =', context.bindingData.sequenceNumber);
    context.log('Offset =', context.bindingData.offset);

    context.done();

    eventHubMessages.forEach((message, index) => {
        context.log(`Processed message ${message}`);
    });
};

```

`func start` ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

ã™ã‚‹ã¨ãƒ­ãƒ¼ã‚«ãƒ«ã§é–¢æ•°ãŒèµ·å‹•ã—ã€ã‚¤ãƒ™ãƒ³ãƒˆå¾…ã¡ã®çŠ¶æ…‹ã«ãªã‚Šã¾ã™ã€‚

ã“ã®çŠ¶æ…‹ã§ã€åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’èµ·å‹•ã—ã€ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

ç¹°ã‚Šè¿”ã—ã«ãªã‚Šã¾ã™ãŒã€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã§ã™ã­ã€‚

```js:src/send.js
const { EventHubProducerClient } = require('@azure/event-hubs')

const connectionString = "Endpoint=sb://sample-azfunc-basic-eventhub.servicebus.windows.net/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=eunsC8UuZlJxJLaX9ewYFoa0GwwuoHQr8XDc4fNGt90="
const eventHubName = "samples-workitems";

async function main() {
  const producer = new EventHubProducerClient(connectionString, eventHubName);

  const batch = await producer.createBatch()
  batch.tryAdd({ body: "1ã¤ã‚ã®ã‚¤ãƒ™ãƒ³ãƒˆ"})
  batch.tryAdd({ body: "2ã¤ã‚ã®ã‚¤ãƒ™ãƒ³ãƒˆ" })
  batch.tryAdd({ body: "3ã¤ã‚ã®ã‚¤ãƒ™ãƒ³ãƒˆ" })

  await producer.sendBatch(batch)

  await producer.close()

  console.log("A batch of three events have been sent to the event hub");
  console.log('Event Hubs ã«3ã¤ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚')
}

main().catch((err) => {
  console.log('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸï¼š', err)
})

```

ã“ã‚Œã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€é–¢æ•°å´ã®æ–¹ã§ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

```console
[2022-01-08T07:10:52.712Z] Worker process started and initialized.
[2022-01-08T07:10:57.941Z] Host lock lease acquired by instance ID '000000000000000000000000383179D0F'.
[2022-01-08T07:11:05.602Z] Executing 'Functions.EventHubTrigger' (Reason='(null)', Id=597175a3-d8bd-4fdb-9aeb-e6d5d0182u3c0sf)
[2022-01-08T07:11:05.603Z] Trigger Details: PartionId: 0, Offset: 0-192, EnqueueTimeUtc: 2022-01-08T07:11:05.4150000Z-2022-01-08T07:11:05.4150000Z, SequenceNumber: 0-2, Count: 3
[2022-01-08T07:11:05.683Z] JavaScript eventhub trigger function called for message array 1ã¤ã‚ã®ã‚¤ãƒ™ãƒ³ãƒˆ,2ã¤ã‚ã®ã‚¤ãƒ™ãƒ³ãƒˆ,3ã¤ã‚ã®ã‚¤ãƒ™ãƒ³ãƒˆ
[2022-01-08T07:11:05.683Z] Function triggered to process a message:  [ '1ã¤ã‚ã®ã‚¤ãƒ™ãƒ³ãƒˆ', '2ã¤ã‚ã®ã‚¤ãƒ™ãƒ³ãƒˆ', '3ã¤ã‚ã®ã‚¤ãƒ™ãƒ³ãƒˆ' ]
[2022-01-08T07:11:05.683Z] EnqueuedTimeUtc = undefined
[2022-01-08T07:11:05.684Z] SequenceNumber = undefined
[2022-01-08T07:11:05.684Z] Offset = undefined
[2022-01-08T07:11:05.716Z] Executed 'Functions.EventHubTrigger' (Succeeded, Id=597175a3-d8bd-4fdb-9aeb-e6d5d0182u3c0sf, Duration=141ms)
```

ã“ã‚“ãªé¢¨ã«ã€ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ã‘å–ã£ã¦é–¢æ•°ã‚’èµ·å‹•ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
