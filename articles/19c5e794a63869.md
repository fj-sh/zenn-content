---
title: "Node.js ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå§‹ã‚ã‚‹ã¾ã§ã«ã‚„ã‚‹ã“ã¨"
emoji: "ğŸ“–"
type: "tech"
topics: ["nodejs"]
published: true
---

## `npm init`ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒªã‚’ä½œæˆã—ã¦ã€ãã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```console
$ npm init -y
$ mkdir src
$ touch src/app.ts
# ã¾ãŸã¯
# touch src/index.ts
# ã¾ãŸã¯
# touch src/main.ts
```

## TypeScript ã®å®Ÿè¡Œç’°å¢ƒã‚’ä½œã‚‹

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```console
$ npm i -D typescript ts-node ts-node-dev
$ npx tsc --init
```

`package.json`ã® `scripts` ã«ä»¥ä¸‹ã‚’ç™»éŒ²ã—ã¾ã™ã€‚

```json:package.json
"scripts": {
    "dev": "ts-node-dev --respawn ./src/app.ts",
    "start": "ts-node --transpile-only ./src/app.ts",
}
```

### Node + express ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å§‹ã‚ã‚‹å ´åˆ

```console
$ npm i -D @types/node
$ npm i express
$ npm i -D @types/express
```

#### å‚è€ƒ

[çŸ¥è­˜ã‚¼ãƒ­ã‹ã‚‰å§‹ã‚ã‚‹ TypeScript ã€œåŸºæœ¬ç·¨ã€œ](https://qiita.com/yukiji/items/52ea9106e254c1a12dea)

## ESLint ã¨ Prettier ã‚’å°å…¥ã™ã‚‹

### ESLint ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```console
$ npm i --save-dev eslint typescript @typescript-eslint/parser @typescript-eslint/eslint-plugin
$ npx eslint --init
```

### Prettier ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ESLint ã¯ã‚³ãƒ¼ãƒ‰ã®æ­£ã—ã•ã‚’ä¿ã¤ã®ã«å¯¾ã—ã€ Prettier ã¯ã‚³ãƒ¼ãƒ‰ã®èª­ã¿ã‚„ã™ã•ã‚’ä¿ã¤ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

```console
$ npm install --save-dev prettier
$ npm install --save-dev eslint-config-prettier
# ã¾ãŸã¯
# $ npm install --save-dev eslint-config-prettier eslint-plugin-prettier

$ touch .prettierrc.js
# ã¾ãŸã¯
# $ touch .prettierrc
```

`eslint-config-prettier`ã¯ ESLint ã®ãƒ«ãƒ¼ãƒ«ã®ã†ã¡ã€Prettier ã¨ç›¸å®¹ã‚Œãªã„ã‚‚ã®ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹å…±æœ‰è¨­å®šã§ã™ã€‚

`eslint-plugin-prettier`ã¯ Prettier ã®ãƒ«ãƒ¼ãƒ«ã‚’ ESLint ã®ãƒ«ãƒ¼ãƒ«ã«çµ±åˆã™ã‚‹ãŸã‚ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚

```diff js:.eslintrc.js
module.exports = {
  env: {
    browser: true,
    es2021: true
  },
  extends: [
    'standard',
+    'prettier',
  ],
  parser: '@typescript-eslint/parser',
  parserOptions: {
    ecmaVersion: 12,
    sourceType: 'module'
  },
  plugins: [
    '@typescript-eslint'
  ],
  rules: {
  }
}
```

`'module' is not defined`ã¨è¡¨ç¤ºã•ã‚ŒãŸå ´åˆï¼š

```diff js:.eslintrc.js
module.exports = {
  env: {
    browser: true,
    es2021: true,
+      node: true,
  },
```

```js:.prettierrc.js
module.exports = {
  singleQuote: true,
  trailingComma: 'es5',
  printWidth: 100,
  semi: false,
}
```

```diff json:package.json
  "scripts": {
    "dev": "ts-node-dev --respawn",
+    "eject": "expo eject",
+    "lint": "eslint './src/**/*.{js,ts,tsx}'",
+    "lint:fix": "eslint --fix './src/**/*.{js,ts,tsx}'",
+    "format": "prettier --check ./src",
+    "format:fix": "prettier --write ./src"
  },
```

`"scripts"`ã«ã‚‚æ›¸ã„ã¦ã„ã¾ã™ãŒã€`--check`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã¦å®Ÿè¡Œã™ã‚‹ã¨ã€Prettier ã¯ã‚³ãƒ¼ãƒ‰ã®å†…å®¹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã ã‘ã§æ•´å½¢ã¯ã—ã¾ã›ã‚“ã€‚

`--write`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã‚‹ã¨ã€`.prettierrc`ï¼ˆ`.prettierrc.js`ï¼‰ã®è¨­å®šã«åŸºã¥ã„ã¦ã‚³ãƒ¼ãƒ‰ãŒæ•´å½¢ã•ã‚Œã¾ã™ã€‚

### WebStorm ã®è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®è¨­å®š

ç§ã®å ´åˆã¯ WebStorm ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ã€ WebStorm ã®è¨­å®šã«ã¤ã„ã¦è¨˜è¼‰ã—ã¾ã™ãŒã€ Visual Studio Code ã«ã‚‚åŒæ§˜ã®æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚

`WebStorm > Preferences > Languages & Frameworks > JavaScript > Code Quality Tools > ESLint`ï¼š

![](https://storage.googleapis.com/zenn-user-upload/6b52aecfd5c08c2903b56b28.png)

`WebStorm > Preferences > Languages & Frameworks > JavaScript > Prettier`ï¼š

![](https://storage.googleapis.com/zenn-user-upload/504b23eb23892c5c06c88edd.png)

### React Hooks ã®ãƒã‚°ã‚’æ¤œå‡ºã™ã‚‹

ã€React ãƒãƒ³ã‚ºã‚ªãƒ³ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ã€ã® 10 ç« ã« ESLint ã«ã¤ã„ã¦ã®è¨˜äº‹ãŒã‚ã£ãŸã®ã§è¿½è¨˜ã—ã¾ã™ã€‚
React Hooks ã®ãƒã‚°ã‚’æ¤œå‡ºã™ã‚‹ãŸã‚ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«ã¤ã„ã¦ã§ã™ã€‚

```console
$ npm install eslint-plugin-react-hooks --save-dev
```

`.eslintrc.js`ã‚„ã€`.eslintrc.json`ã«ä»¥ä¸‹ã‚’è¿½è¨˜ã—ã¾ã™ã€‚

```diff json:.eslintrc.json
"plugins": [
   "react",
+  "react-hooks"
],
"rules": {
+  "react-hooks/rules-of-hooks": "error",
+  "react-hooks/exhaustive-deps": "warn"
}
```

react-hooks ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ `use` ã§å§‹ã¾ã‚‹é–¢æ•°ã‚’ React ãƒ•ãƒƒã‚¯ã¨ã¿ãªã—ã€ä¸€å®šã®ãƒ«ãƒ¼ãƒ«ã«å¾“ã£ã¦ã„ã‚‹ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚

#### å‚è€ƒ

[React Native ã‚’ TypeScript + ESLint + Prettier + Storybook ã§ç’°å¢ƒæ§‹ç¯‰](https://zenn.dev/rikutoyamaguchi/articles/react-native-setup)

## E2E ãƒ†ã‚¹ãƒˆ

Playwright ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```console
$ npm i -D @playwright/test
$ npx playwright install

# ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãªã©ã« playwright ã‚’ä½¿ã†å ´åˆ
$ npm i playwright
```

#### å‚è€ƒ

[Getting Started - Playwright](https://playwright.dev/docs/intro/)

## å˜ä½“ãƒ†ã‚¹ãƒˆ

```console
$ npm i jest @types/jest ts-jest -D
$ touch jest.config.js
```

```js:jest.config.js
module.exports = {
  "roots": [
    "<rootDir>/src"
  ],
  "testMatch": [
    "**/__tests__/**/*.+(ts|tsx|js)",
    "**/?(*.)+(spec|test).+(ts|tsx|js)"
  ],
  "transform": {
    "^.+\\.(ts|tsx)$": "ts-jest"
  },
}
```

#### å‚è€ƒ

[Jest - TypeScript Deep Dive](https://typescript-jp.gitbook.io/deep-dive/intro-1/jest)

## Node.js ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å›ºå®šã™ã‚‹

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« `.node-version` ã‚’ä½œæˆã—ã¾ã™ã€‚

```console
$ touch .node-version
```

`.node-version` ãƒ•ã‚¡ã‚¤ãƒ«ã« Node.js ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

### Node + Express ã§ API ã‚µãƒ¼ãƒãƒ¼ã‚’ä½œã‚‹å ´åˆ

[Project structure for an Express REST API when there is no "standard way"](https://www.coreycleary.me/project-structure-for-an-express-rest-api-when-there-is-no-standard-way) ã‚’å‚è€ƒã«ã™ã‚‹å ´åˆã€‚

```console
$ cd src
$ mkdir {controllers,db,routes,services,tests,utils}
$ touch {controllers/index.ts,db/index.ts,routes/index.ts,services/index.ts,utils/index.ts}
```

[A better project structure with Express and Node.Js](https://medium.com/codechef-vit/a-better-project-structure-with-express-and-node-js-c23abc2d736f) ã‚’å‚è€ƒã«ã™ã‚‹å ´åˆã€‚

```console
$ cd src
$ mkdir {controllers,routes,models,middleware}
$ touch {controllers/index.ts,routes/index.ts,models/index.ts,middleware/index.ts}
```

## Node.js + express ã‚µãƒ¼ãƒãƒ¼ã‚’å‹•ã‹ã™

```ts:src/app.ts
import express from 'express'

const app: express.Express = express()

app.get('/', (req, res) => {
  res.send('Hello world')
})

app.listen(3000, () => {
  console.log('Node.js app listening on port 3000!')
})
```

```console
 $ npm run dev
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://localhost:3000/` ã‚’å©ãã¨ `Hello World` ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

## ç’°å¢ƒå¤‰æ•°ã‚’åˆ©ç”¨ã™ã‚‹

```console
$ npm install dotenv --save
$ touch .env
```

```.env
TEST_ENV='This is test config!'
```

```js:src/app.ts
import dotenv from 'dotenv'

dotenv.config()
const env = process.env.TEST_ENV
console.log('env:', env) // env: This is test config!
```

## cron ã‚’åˆ©ç”¨ã™ã‚‹

```console
$ npm i cron
$ npm i -D @types/cron
```

```js:services/cronService.ts
import { CronJob } from 'cron'

export const useCronService = () => {
  const cronJob = new CronJob('10 * * * * *', () => {
    console.log('Hello Cron!')
  })

  return {
    cronJob,
  }
}

```

#### å‚è€ƒ

[How to make a Cron job for a typescript class method](https://stackoverflow.com/questions/64777543/how-to-make-a-cron-job-for-a-typescript-class-method)

## React ã§ TypeScript ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å§‹ã‚ã‚‹

```console
$ npx create-react-app my-type-app --template typescript
```

### React Hooks ESLint ãƒ—ãƒ©ã‚°ã‚¤ãƒ³

```console
$ npm install eslint-plugin-react-hooks --save-dev
```

```json
// Your ESLint configuration
{
  "plugins": [
    // ...
    "react-hooks"
  ],
  "rules": {
    // ...
    "react-hooks/rules-of-hooks": "error", // Checks rules of Hooks
    "react-hooks/exhaustive-deps": "warn" // Checks effect dependencies
  }
}
```

[ãƒ•ãƒƒã‚¯ã®ãƒ«ãƒ¼ãƒ«](https://ja.reactjs.org/docs/hooks-rules.html#eslint-plugin)

## ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒãƒ¼ã®æº–å‚™

```console
$ npm i json-server --dev
$ npx json-server --watch db.json --port 3100

  \{^_^}/ hi!

```

```json:db.json
{
  "todos":[
    {
      "id": 1,
      "content": "Install Create React App",
      "done": true
    },
    {
      "id": 2,
      "content": "ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒãƒ¼ã‚’æº–å‚™ã™ã‚‹",
      "done": false
    },
    {
      "id": 3,
      "content": "ç¶™ç¶šçš„ãƒ‡ãƒ—ãƒ­ã‚¤ã®æº–å‚™ã‚’ã™ã‚‹",
      "done": false
    }
  ]
}

```

`http://localhost:3100/todos`ã§ JSON ã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
