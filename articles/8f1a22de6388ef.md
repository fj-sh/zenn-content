---
title: "React ã§ Chrome æ‹¡å¼µã‚’é–‹ç™ºã™ã‚‹æ‰‹é †"
emoji: "ğŸ“˜"
type: "tech"
topics: []
published: false
---

React ã§ Chrome æ‹¡å¼µã‚’é–‹ç™ºã™ã‚‹æ‰‹é †ã§ã™ã€‚

```console
$ npx create-react-app . --template typescript
$ npm i @types/chrome -D
$ npm i -D @types/react-dom
$ npm i react-router-dom
$ npm i -D @types/react-router-dom
```

`public/manifest.json`ã‚’ç·¨é›†ã—ã¾ã™ã€‚

```json:public/manifest.json
{
  "name": "Example Extensions",
  "description": "Base Level Extension",
  "version": "1.0",
  "manifest_version": 2,
  "browser_action": {
    "default_popup": "index.html",
    "default_title": "Open the popup"
  },
  "icons": {
    "16": "logo192.png",
    "48": "logo192.png",
    "128": "logo192.png"
  },
  "content_security_policy": "script-src 'self' 'unsafe-eval'; object-src 'self'"
}
```

`package.json`ã‚’ç·¨é›†ã—ã¾ã™ã€‚

```diff json:package.json
  "scripts": {
    "start": "react-scripts start",
-    "build": "react-scripts build",
+    "build": "INLINE_RUNTIME_CHUNK=false react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
  },
```

### `TS2307: Cannot find module './logo.svg' or its corresponding type declarations.` ã®å¯¾å¿œ

```console
$ touch src/custom.d.ts
```

```js:src/custom.d.ts
declare module "*.svg" {
  const content: any;
  export default content;
}
```

```json:tscondig.json
"include": ["src/components", "src/custom.d.ts"]
```

[Unable to import svg files in typescript](https://stackoverflow.com/questions/44717164/unable-to-import-svg-files-in-typescript)


## Chrome æ‹¡å¼µã‚’å‹•ã‹ã—ã¦ã¿ã‚‹

```console
$ npm run build
```

ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã« `chrome://extensions/` ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

ã€Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã•ã‚Œã¦ã„ãªã„æ‹¡å¼µæ©Ÿèƒ½ã‚’èª­ã¿è¾¼ã‚€ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/fe9b53f48923554de9f4d457.png)

`npm run build` ã§ä½œæˆã•ã‚ŒãŸ `build` ãƒ•ã‚©ãƒ«ãƒ€ã‚’é¸æŠã—ã¾ã™ã€‚

ã™ã‚‹ã¨ã€Chrome æ‹¡å¼µãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚

å³ä¸Šã®ã‚¸ã‚°ã‚½ãƒ¼ãƒ‘ã‚ºãƒ«ã®ã‚ˆã†ãªã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€èª­ã¿è¾¼ã‚“ã Chromeæ‹¡å¼µã‚’ãƒ”ãƒ³ç•™ã‚ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

![](https://storage.googleapis.com/zenn-user-upload/85f5de58cc4864259241c332.png)

ä»Šå¾Œã€ã‚½ãƒ¼ã‚¹ã‚’æ›¸ãæ›ãˆã¦ã€å†…å®¹ã‚’åæ˜ ã—ãŸã„ã¨ãã¯ã€ä»¥ä¸‹ã®é †ã§å†èª­ã¿è¾¼ã¿ã‚’è¡Œã„ã¾ã™ã€‚

1. `npm run build` 
2. `chrome://extensions/`ã®ã€Œæ›´æ–°ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
3. æ‹¡å¼µã®ãƒªãƒ­ãƒ¼ãƒ‰ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

ä¸Šè¨˜ã®æ‰‹é †ãŒé¢å€’ãªå ´åˆã€[Extensions Reloader](https://chrome.google.com/webstore/detail/extensions-reloader/fimgfedafeadlieiabdeeaodndnlbhid)ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠã‘ã°ã€ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§å†èª­ã¿è¾¼ã¿ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

### Chromeæ‹¡å¼µé–‹ç™ºã§ `console.log` ã‚’è¦‹ãŸã„å ´åˆ

æ‹¡å¼µã®ã‚¢ã‚¤ã‚³ãƒ³ã‚¯ãƒªãƒƒã‚¯â†’ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒå‡ºã¦ãã‚‹â†’ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’å³ã‚¯ãƒªãƒƒã‚¯â†’ã€Œæ¤œè¨¼ã€ã‚’ã‚¯ãƒªãƒƒã‚¯

Chromeæ‹¡å¼µç”¨ã® Deveper Tools ãŒé–‹ãã€ Console ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚


## ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–ã®æƒ…å ±ã‚’å–å¾—ã™ã‚‹

`manifest.json`ã€€ã‚’ç·¨é›†ã—ã¾ã™ã€‚

```diff json:public/manifest.json
{
  "name": "Example Extensions",
  "description": "Base Level Extension",
  "version": "1.0",
  "manifest_version": 2,
  "browser_action": {
    "default_popup": "index.html",
    "default_title": "Open the popup"
  },
  "icons": {
    "16": "logo192.png",
    "48": "logo192.png",
    "128": "logo192.png"
  },
  "content_security_policy": "script-src 'self' 'unsafe-eval'; object-src 'self'",
+  "permissions": [
+    "activeTab"
+  ]
}
```

```js:src/App.tsx
import React, { useEffect, useState } from 'react'
import logo from './logo.svg'
import './App.css'

export const App = () => {
  const [url, setUrl] = useState<string | undefined>('')

  /**
   * ç¾åœ¨ã® URL ã‚’å–å¾—ã™ã‚‹ã€‚
   */
  useEffect(() => {
    const queryInfo = { active: true, lastFocusedWindow: true }

    chrome.tabs &&
      chrome.tabs.query(queryInfo, (tabs) => {
        const url = tabs[0].url
        setUrl(url)
      })
  }, [])

  return (
    <div className="App">
      <header className="App-header">
        <img src={logo} className="App-logo" alt="logo" />
        <p>URL:</p>
        <p>{url}</p>
      </header>
    </div>
  )
}

export default App
```

![](https://storage.googleapis.com/zenn-user-upload/5a16390883f040ff11d8ee3a.png)

### `Could not find a required file.  Name: index.js` ã®å¯¾å¿œ

`npm run build` ã‚’å®Ÿè¡Œã—ãŸã¨ãã« `Could not find a required file.  Name: index.js` ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆã®å¯¾å¿œï¼š

```console
$ npm audit fix --force
$ npm i react-scripts
```

["Could not find a required file" on `yarn start`](https://stackoverflow.com/questions/49724813/could-not-find-a-required-file-on-yarn-start)

## DOM ã‚’æ“ä½œã™ã‚‹

`manifest.json` ã‚’ç·¨é›†ã—ã¾ã™ã€‚

```diff json:public/manifest.json
  "content_security_policy": "script-src 'self' 'unsafe-eval'; object-src 'self'",
  "permissions": [
    "activeTab"
  ],
+  "optional_permissions": [
+    "<all_urls>"
+  ]
+  "content_scripts": [
+    {
+      "matches": ["http://*/*", "https://*/*"],
+      "js": ["./static/js/content.js"],
+      "all_frames": false,
+      "run_at": "document_end"
+    }
+  ]
```

[Substitute the activeTab permission](https://developer.chrome.com/docs/extensions/mv3/permission_warnings/#activeTab_permission)

`public/content.js`ã¨ã„ã†ç©ºãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```console
$ touch public/content.js
```


## å‚è€ƒ

[How To Create A Google Chrome Extension With React](https://medium.com/litslink/how-to-create-google-chrome-extension-using-react-js-5c9e343323ff)
[Creating a Chrome extension with React and TypeScript](https://blog.logrocket.com/creating-chrome-extension-react-typescript/)