---
title: "Node.js + MongoDB ã®é–‹ç™ºç’°å¢ƒã‚’ Docker ã§æ§‹ç¯‰"
emoji: "ğŸ™†"
type: "tech"
topics: []
published: false
---

Node.js + MogoDB ã®ç’°å¢ƒã‚’ Docker ã§æ§‹ç¯‰ã—ã¾ã™ã€‚

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã™ã‚‹

```console
$ mkdir nginx src
$ touch nginx/default.conf src/app.js Dockerfile docker-compose.yml .env
$ npm init -y
$ npm i mongoose express
```

## Nginx ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã™ã‚‹

```yml:nginx/default.conf
server {
  listen 80;
  server_name localhost;
  error_log /var/log/nginx/error.log;
  access_log /var/log/nginx/access.log;
  root /app;

  location / {
    proxy_pass http://server:8080/;
  }
}
```

## Dockerfile ã‚’ç·¨é›†ã™ã‚‹

```dockerfile:Dockerfile
FROM node:alpine

WORKDIR /usr/src/app

COPY package.json ./   
RUN npm install

COPY src .

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•
CMD [ "node", "app.js" ]
```

## docker-compose.yml ã‚’ç·¨é›†ã™ã‚‹

```yml:docker-compose.yml
version: "3"

services:
  server:
    build: ./src
    container_name: "server"
    ports:
      - 8080:8080
    links:
      - mongo
    depends_on:
      - mongo
    volumes:
      - ./src:/server
      - /home/app/nodeapp/node_modules

  nginx:
    image: nginx:latest
    container_name: "nginx"
    ports:
      - "80:80"
    depends_on:
      - server
    volumes:
      - ./src:/server
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf:cached

  mongo:
    image: mongo
    container_name: "mongo"
    command:
      - mongod
    ports:
      - 27017:27017
    volumes:
      - mongo-data:/data/db

  mongo-data:
    image: busybox

volumes:
  mongo-data:
```

## Docker ã‚’èµ·å‹•ã™ã‚‹

```console
$ docker compose up
```

